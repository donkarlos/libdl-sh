#! /bin/sh ##
#-----------------------------------------------------------------------------
#   atlocal			- Test suite's local definitions
#
#   Copyright Â© 2021 Das Computerlabor (DCl-M)
#
#   This library is free software; you can redistribute it and/or
#   modify it under the terms of the GNU Lesser General Public License
#   as published by the Free Software Foundation; either
#   version 2.1 of the License, or (at your option) any later version.
#
#   This library is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#   Lesser General Public License for more details.
#
#   You should have received a copy of the GNU Lesser General Public License
#   along with this library; if not, write to the Free Software Founda-
#   tion, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
##
##  AUTHOR(S):	ks	Karl Schmitz <ks@computerlabor.org>
##
##  WRITTEN BY:	ks	2021-04-28
##  CHANGED BY:	ks	2021-05-03	Define PACKAGE_TARNAME, PACKAGE_-
##					VERSION, and installation directories.
##		ks	2021-05-18	Declare global variables readonly.
##					Add atlocal_loggable() and atlocal_-
##					get_specials().
##----------------------------------------------------------------------------
##  Global variables:
#-----------------------------------------------------------------------------
PACKAGE_TARNAME=@PACKAGE_TARNAME@
PACKAGE_VERSION=@PACKAGE_VERSION@
bindir=@bindir@
libdir=@shlibdir@
pkgdatadir=@pkgdatadir@
sysconfdir=@sysconfdir@
readonly PACKAGE_TARNAME PACKAGE_VERSION bindir libdir pkgdatadir sysconfdir

##----------------------------------------------------------------------------
##  atlocal_loggable(ARG ...)	Make ARGument(s) loggable by rewriting cer-
##				tain "dangerous" (to some editors or m4(1))
##				characters
##
##  Non-local variables:
##	- NL		(R) The newline   character.
##	- BS		(R) The backspace character.
##----------------------------------------------------------------------------
atlocal_loggable() {
    local ifs string; ifs=$IFS; IFS=,; string=$*; IFS=$ifs; sed '
	:N'"$NL"'$!{;N;bN'"$NL"'}
	s/'"$BS$NL"'/<NL>/g;s/'"$CR"'/<CR>/g;s/	/<HT>/g;s/ /<SP>/g
    ' <<EOF
$string
EOF
}

##----------------------------------------------------------------------------
##  atlocal_get_special_cs()	Emit joint set of quote operator's special
##				characters
##
##  Non-local variables:
##	- NL		(R) The newline   character.
##	- BS		(R) The backspace character.
##	- quote_cs_sh	(R) Special sh(1) character set sans '~'.
##	- quote_cs_bre	(R) Special BRE character set sans '^' and '$'.
##	- quote_cs_ere	(R) Special ERE character set with '^' and '$'.
##	- quote_cs_brs	(R) Special 's///' right-hand side character set
##----------------------------------------------------------------------------
atlocal_get_special_cs() {
    sed '
	:N'"$NL"'$!{;N;bN'"$NL"'}
	s/^/%/;:0'"$NL"'s/%\(.\)/\1'"$BS$NL"'%/;t0
	s/%$//
    ' <<EOF | LC_COLLATE=C sort -u | sed '
	:N'"$NL"'$!{;N;s/'"$BS$NL"'//2;tN'"$NL"'bN'"$NL"'}
    '
$quote_cs_sh~$quote_cs_bre^$DS$quote_cs_ere$quote_cs_brs
EOF
}
